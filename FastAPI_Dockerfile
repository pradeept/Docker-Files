# Base Image
# python<version>-slim based on your requirement
FROM python:3.9-slim 

# Set env vars
ENV USER=app_name 

# Create an user to avoid root execution
RUN useradd -m ${USER}
USER ${USER}

# Set working directory
WORKDIR /home/${USER}/

# Copy requirements.txt or poetry.lock or .toml
COPY --chown=${USER} poetry.lock .

# Create & use a virtual environment
RUN python -m venv && source venv/bin/activate

# Install poetry & dependencies
RUN python3 -m pip install poetry && poetry install

# Copy project files
COPY --chown=${USER} . .

# Expose required port
EXPOSE 5000

# Entrypoint
CMD ["uvicorn main:app --host 0.0.0.0 --port 5000"]
